# 替换器的工作原理

## 生成器(generator)

新的替换器和格雷生成语言文件的方式是相同的。具体来说就是通过定义一系列的生成器组合生成翻译项。生成器公有的属性包括：

* 组名
* 命名空间
* 是否完整
* 是否缓存
* 扩展信息
* 生成方法及对应的生成信息

按照生成方法，生成器可以分为两类：字典生成器和规则生成器。字典生成器包含一组原文-译文词汇对，输出所有的词汇对。规则生成器包含一到多个规则，每个规则包含原文、译文模板以及对应的组名。每个模板由一条字符串定义，其包含一系列形如{0}{1}的占位符以便替换。例如：

```plain
Machine ({0}, {1})
机器（{0}，{1}）
[material, fuel_type]
```

整个替换过程需要的信息就是这么多。替换过程开始时，根据扩展信息读取所有已定义的生成器。如果生成器是字典生成器，则将输出定义为字典的所有词汇对。如果生成器是规则生成器，则对每条规则在命名空间的约束条件下进行生成操作，将结果取并后输出。每条规则的生成操作，就是计算其包含的所有组的元素的笛卡尔积，然后填入模板中输出。

## 注释

1. 一个组名可能对应多个生成器，结果应取并集。
2. 命名空间即英文原文前面那一段，为了优化性能，筛选条件为前方匹配搜索，交集为前方相同的最长字符串。
3. 是否完整指示生成器生成的结果是否出现在最后的替换步骤中。
4. 是否缓存指示是否需要缓存输出。
5. 除了主要输入输出语言文件外，还可以指定次要输入输出语言文件。次要输入为不适用替换器的项的备选输出。次要输出为未被替换器覆盖的项。当次要输入输出为同一个文件时，替换过程是自更新的。该文件中已被替换器替换的项会被删除，未被替换的项将会被插入。
